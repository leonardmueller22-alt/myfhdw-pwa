<!DOCTYPE HTML>
<html lang="de">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="revisit-after" content="1 days"/>
    <meta name="robots" content="INDEX, FOLLOW"/>
    <title>Dokumente</title>

    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#21376a">
    <link rel="apple-touch-icon" href="./img/homescreen192.png">

    <!-- ✅ REPARIERT: CloudFront CSS raus, stabile CDN-Versionen rein (Layout fix) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">

    <link rel="stylesheet" href="./styles/custom.css" type="text/css" media="all"/>
    <link rel="shortcut icon" href="./favicon.ico" type="image/x-icon"/>

    <style>
        /* Fix für die Fußzeile (Sticky Footer) */
        html, body {
            height: 100%;
            margin: 0;
            display: flex;
            flex-direction: column;
        }

        #container-spacer {
            flex: 1 0 auto;
            min-height: auto;
        }

        footer {
            flex-shrink: 0;
        }

        .navbar-nav > li > a { line-height: 20px !important; }
        .navbar { min-height: 50px !important; border: 1px solid transparent; margin-bottom: 20px; }

        .control-label {
            padding-top: 7px;
            margin-bottom: 0;
            text-align: right;
            font-weight: bold;
            color: #333;
        }

        .btn-primary {
            background-color: #337ab7;
            border-color: #2e6da4;
            color: #fff;
        }

        /* Button ist standardmäßig NICHT SICHTBAR */
        #download-btn { display: none; }
    </style>

    <!-- ✅ REPARIERT: CloudFront JS raus, stabile CDN-Versionen rein -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js"></script>
</head>

<body id="community-facelift">

    <div id="container-spacer">
        <div class="community-facelift header-logo-box">
            <div class="container" style="overflow: hidden;">
                <a title="Home" href="./dashboard.html">
                    <img src="./img/Community_Banner.jpg" class="img-responsive" alt="page logo"/>
                </a>
            </div>
        </div>

        <nav role="navigation" id="top-navigation" class="navbar navbar-default community-facelift">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse-id">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a href="./dashboard.html" class="navbar-brand">
                        <span class="glyphicon glyphicon-home"></span>
                    </a>
                </div>
                <div class="collapse navbar-collapse" id="navbar-collapse-id">
                    <ul class="nav navbar-nav">
                        <li><a href="./profile.html">Mein Profil</a></li>
                        <li><a href="./timetable.html">Stundenplan</a></li>
                        <li><a href="./pruefungstermine.html">Prüfungstermine</a></li>
                        <li><a href="./notenuebersicht.html">Notenübersicht</a></li>
                        <li class="active"><a href="./dokumente.html">Dokumente</a></li>
                        <li><a href="./abgaben.html">Abgaben</a></li>
                        <li><a href="./kurzbewerbung.html">Kurzbewerbung Master-Studium</a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="container" style="padding-top: 15px; padding-bottom: 15px;">
            <div class="pull-right">
                <div class="btn-group">
                    <button type="button" class="btn btn-default dropdown-toggle dropdown-slim" data-toggle="dropdown">
                        <span class="fa fa-user"></span> Mehmet Güngörmez <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu">
                        <li><a href="./index.html"><span class="fa fa-power-off"></span> Ausloggen</a></li>
                    </ul>
                </div>
            </div>
            <div class="pull-left">
                <div class="community-facelift btn-group btn-breadcrumb">
                    <a class="btn btn-default" href="./dashboard.html">Startseite</a>
                    <a class="btn btn-default" href="./dokumente.html">Dokumente</a>
                </div>
            </div>
        </div>

        <div class="container">
            <form id="documentForm" class="form-horizontal" role="form" onsubmit="return false;">

                <div class="form-group">
                    <label for="documentId" class="col-sm-2 col-xs-12 control-label">Dokument</label>
                    <div class="col-sm-10 col-xs-12">
                        <select class="form-control" name="documentId" id="documentId" onchange="checkDownload()">
                            <option value="" selected>Bitte wählen</option>

                            <!-- ✅ FUNKTION NICHT ÄNDERN: Werte bleiben wie bei dir -->
                            <option value="files/praesentation.pdf">PowerPoint Folie - PWA</option>
                            <option value="files/handout.pdf">Präsentation Handout - PWA</option>
                        </select>
                    </div>
                </div>

                <div class="row">
                    <div class="col-xs-12"><br/></div>
                </div>

                <div class="row">
                    <div class="col-xs-12">
                        <button id="download-btn" class="btn btn-default btn-primary pull-right">
                            Herunterladen
                        </button>
                    </div>
                </div>
            </form>

            <div style="height: 50px;"></div>
        </div>
    </div>

    <footer class="community-facelift footer-bootstrap footer-info">
        <div class="container">
            <div class="row">
                <div class="col-xs-12 col-sm-9"><p>Fachhochschule der Wirtschaft</p><p>Paderborn | Bergisch Gladbach | Bielefeld | Marburg | Mettmann</p></div>
                <div class="col-xs-12 col-sm-3 text-right"><a href="#">Kontakt</a> &nbsp;&nbsp;&nbsp; <a href="#">Impressum</a></div>
            </div>
        </div>
    </footer>

    <footer class="community-facelift footer-bootstrap-academyFive footer-meta">
        <div class="container">
            <div class="row">
                <div class="col-xs-12"><div id="academyFiveFooter" class="text-center"><a href="https://www.simovative.com" target="_blank">&copy; academyFIVE</a></div></div>
            </div>
        </div>
    </footer>

    <script>
        // GLOBALE FUNKTION (für onchange im HTML)
        function checkDownload() {
            var val = document.getElementById('documentId').value;
            var btn = document.getElementById('download-btn');

            if (val && val !== "") {
                btn.style.display = 'block';
            } else {
                btn.style.display = 'none';
            }
        }

        $(document).ready(function() {
            // Service Worker
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', function() {
                    navigator.serviceWorker.register('./sw.js');
                });
            }

            // Benachrichtigungen
            if (Notification.permission !== "granted" && Notification.permission !== "denied") {
                Notification.requestPermission();
            }

            // jQuery Listener als Sicherung
            $('#documentId').on('change input blur keyup', function() {
                checkDownload();
            });

            // Initial prüfen
            checkDownload();

            function sendPushNotification(fileName) {
                if (Notification.permission === "granted") {
                    navigator.serviceWorker.getRegistration().then(function(reg) {
                        var options = {
                            body: fileName + ' wurde erfolgreich heruntergeladen.',
                            icon: 'img/homescreen192.png',
                            vibrate: [100, 50, 100],
                            data: { dateOfArrival: Date.now() }
                        };
                        if (reg) {
                            reg.showNotification('Download abgeschlossen', options);
                        } else {
                            new Notification('Download abgeschlossen', options);
                        }
                    });
                }
            }

            // BUTTON KLICK MIT HANDY-FIX (target="_blank")  ✅ NICHT KAPUTT GEMACHT
            $('#download-btn').click(function() {
                var selectedValue = $('#documentId').val();
                var selectedText = $("#documentId option:selected").text();

                if(selectedValue) {
                    var link = document.createElement('a');
                    link.href = selectedValue;

                    // --- HANDY FIX: Öffnet neuen Tab statt verstecktem Download ---
                    link.target = "_blank";

                    link.download = selectedValue.split('/').pop();
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);

                    setTimeout(function() {
                        sendPushNotification(selectedText);
                    }, 500);
                }
            });

            // AUTO LOGOUT
            var inactivityTime = function () {
                var time;
                window.onload = resetTimer;
                document.onmousemove = resetTimer;
                document.onkeypress = resetTimer;
                document.onclick = resetTimer;
                document.ontouchstart = resetTimer;

                function logout() {
                    window.location.href = 'index.html';
                }

                function resetTimer() {
                    clearTimeout(time);
                    time = setTimeout(logout, 180000);
                }
            };
            inactivityTime();
        });
    </script>
</body>
</html>
